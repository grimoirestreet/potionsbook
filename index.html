<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grimoire Street â€¢ Potions Compendium (1890s)</title>
<style>
  :root{
    --bg:#15181d;          /* page */
    --panel:#1e232a;       /* main cards */
    --side:#1b1f25;        /* sidebar */
    --ink:#eef0f3;         /* text */
    --muted:#aab0ba;       /* secondary text */
    --line:#282d35;        /* hairline */
    --accent:#d3ba7c;      /* bronze */
    --pill:#262b33;        /* chip */
    --pill-soft:#222730;
    --danger:#ff6b6b;
  }
  html,body{background:var(--bg); color:var(--ink); margin:0; overflow-y:auto}
  body{font-family:"Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; line-height:1.55}
  *,*::before,*::after{box-sizing:border-box}
  .wrap{max-width:1120px; margin:28px auto; padding:0 16px}

  /* Header */
  h1{margin:0 0 2px 0; font-size:clamp(26px,3.2vw,38px); font-weight:700; letter-spacing:.01em; color:var(--accent)}
  .sub{color:var(--muted); font-size:14px}
  .rule{height:1px; background:var(--line); margin:16px 0 18px}

  /* Layout */
  .grid{display:grid; grid-template-columns:300px 1fr; gap:18px; align-items:start}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}

  /* Sidebar */
  .side{position:static; align-self:start; background:var(--side); border:1px solid var(--line); border-radius:14px; padding:12px}
  @media(min-width:981px){.side.is-sticky{position:sticky; top:12px; will-change:top}}
  .side h2{margin:0 0 10px 0; font-size:13px; color:var(--muted); letter-spacing:.04em; text-transform:uppercase}
  .field{display:grid; gap:6px; margin-bottom:12px}
  .field label{font-size:12px; color:var(--muted)}
  .input, select{width:100%; background:var(--panel); color:var(--ink); border:1px solid var(--line); border-radius:10px; padding:10px 12px; font-size:14px; line-height:1.2}
  .input::placeholder{color:#c6cbd3; opacity:.85}
  .seg{display:flex; gap:8px; flex-wrap:wrap}
  .seg button{flex:1; background:var(--pill); border:1px solid var(--line); color:var(--ink); padding:8px 10px; border-radius:999px; cursor:pointer; font-size:13px}
  .seg button[aria-pressed="true"]{background:var(--accent); color:#0d0e10; font-weight:600}

  .legend{border-top:1px solid var(--line); margin-top:8px; padding-top:10px}
  .legend h3{margin:0 0 6px 0; font-size:12px; color:var(--muted); letter-spacing:.03em; text-transform:uppercase}
  .legend-top{background:var(--panel); border:1px solid var(--line); border-radius:12px; padding:10px 12px; margin:12px 0 18px}
  .chips{display:flex; flex-wrap:wrap; gap:6px}
  .chip{background:var(--pill-soft); border:1px solid var(--line); color:#d9dde6; padding:6px 10px; border-radius:999px; font-size:12px}
  .chip[data-lvl="Elementary"]{color:#cfe8ff}
  .chip[data-lvl="Intermediate"]{color:#e8d6ff}
  .chip[data-lvl="Advanced"]{color:#ffe7c7}
  .chip[data-lvl="Master"]{color:#ffbdbd}

  .tabs{display:flex; flex-direction:column; border-top:1px solid var(--line); margin-top:10px}
  .tabs button{appearance:none; background:transparent; border:none; text-align:left; padding:10px 12px; border-bottom:1px solid var(--line); cursor:pointer; color:#cfd5de; font-size:14px}
  .tabs button[aria-current="true"]{background:var(--panel); color:var(--accent); font-weight:600}

  /* Panel */
  .panel{background:var(--panel); border:1px solid var(--line); border-radius:14px; overflow:hidden; align-self:start}
  .panel header{padding:14px; border-bottom:1px solid var(--line)}
  .panel h3{margin:0; font-size:18px; font-weight:700; letter-spacing:.01em; color:var(--accent)}
  .how{padding:10px 14px; border-bottom:1px dashed var(--line); color:var(--muted); font-size:14px}

  /* List */
  .list{display:grid}
  details.item{border-bottom:1px solid var(--line)}
  details.item[open] summary{background:#1d2128}
  summary{list-style:none; cursor:pointer; padding:12px 14px; display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; scroll-margin-top:16px}
  summary::-webkit-details-marker{display:none}
  .name{font-weight:600}
  .namewrap{min-width:0}
  .effect-preview{font-size:13px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}
  .pill{display:inline-block; padding:3px 8px; border-radius:999px; background:var(--pill); border:1px solid var(--line); font-size:12px; color:#cfd5de}
  .meta{display:flex; gap:8px; align-items:center}
  .body{padding:10px 14px 14px 14px}
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media(max-width:700px){.grid-2{grid-template-columns:1fr}}
  .spec{background:#1d2128; border:1px solid var(--line); border-radius:10px; padding:10px}
  .spec dt{font-size:12px; color:#c9ced8}
  .spec dd{margin:0 0 8px 0}
  .notes{color:#b7bdc7; font-size:13px; margin-top:8px}
  .empty{padding:16px; color:#b7bdc7}

  .footer{margin-top:16px; color:#b7bdc7; font-size:12px; text-align:center}
  a{color:var(--accent)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Grimoire Street â€¢ Potions Compendium</h1>
      <div class="sub">Hogwarts Legacy era (1890s). Canonâ€‘only by default. Toggle OC to include approved originals.</div>
    </header>
    <div class="rule" aria-hidden="true"></div>

    <!-- Legend -->
    <section class="legend legend-top" aria-label="Legend">
      <h3>Legend â€¢ who can brew?</h3>
      <div class="chips">
        <span class="chip" data-lvl="Elementary">Elementary â†’ Years 1â€“2</span>
        <span class="chip" data-lvl="Intermediate">Intermediate â†’ Years 3â€“5</span>
        <span class="chip" data-lvl="Advanced">Advanced â†’ Years 6â€“7</span>
        <span class="chip" data-lvl="Master">Master â†’ Faculty & Adults only</span>
        <span class="chip">Banned/Controlled per Hogwarts policy</span>
      </div>
    </section>

    <div class="grid">
      <!-- SIDEBAR -->
      <aside class="side" role="complementary">
        <h2>Browse</h2>
        <div class="field">
          <label for="q">Search</label>
          <input id="q" class="input" type="text" placeholder="Search name, effect, ingredients, notesâ€¦" />
        </div>
        <div class="field">
          <label for="dif">Difficulty</label>
          <select id="dif">
            <option value="">All</option>
            <option>Elementary</option>
            <option>Intermediate</option>
            <option>Advanced</option>
            <option>Master</option>
          </select>
        </div>
        <div class="field">
          <label for="year">Year group</label>
          <select id="year">
            <option value="">Any</option>
            <option value="y12">Years 1â€“2</option>
            <option value="y35">Years 3â€“5</option>
            <option value="y67">Years 6â€“7</option>
            <option value="post">Postâ€‘grad / Adult</option>
          </select>
        </div>
        <div class="field">
          <label>Mode</label>
          <div class="seg" role="group" aria-label="Mode">
            <button id="modeCanon" aria-pressed="true">Canon</button>
            <button id="modeAll" aria-pressed="false">Canon + OC</button>
          </div>
        </div>

        <div class="tabs" role="tablist" aria-label="Potion Types"></div>
      </aside>

      <!-- MAIN -->
      <main class="panel" role="region" aria-live="polite">
        <header>
          <h3 id="subjectTitle">Healing & Medical</h3>
        </header>
        <div class="how"><strong>RP use:</strong> Choose a potion type, then search or filter. Keep brewing within your characterâ€™s allowed year group/difficulty. Banned & Combat potions require adminâ€‘approved plots. OC potions show only in Canon+OC mode after staff approval.</div>
        <section id="list" class="list"></section>

        
      </main>
    </div>
    <p class="footer">Report missing or eraâ€‘inaccurate potions to staff.</p>
  </div>

<script>
/***********************
 * TYPES & DATA
 ***********************/
const TYPES = [
  'Healing & Medical',
  'Antidotes',
  'Utility & Academic',
  'Transformation & Disguise',
  'Enhancement & Combat (Restricted)',
  'Forbidden & Controlled',
  'Playerâ€‘Created Potions'
];

// Potion helper
// name, difficulty, restriction, effect, ingredients, instructions, time, notes, appearance, duration, inventor, source, admin
const P = (name,difficulty,restriction,effect,ingredients,instructions,time,notes='',appearance='',duration='',inventor='',source='') =>
  ({name,difficulty,restriction,effect,ingredients,instructions,time,notes,appearance,duration,inventor,source});

// ---- CANON DATA (grouped by type) ----
const CANON = {
  'Healing & Medical':[
    P('Wiggenweld Potion','Elementary','âœ… Students','Heals minor wounds; awakens from magical sleep; counters Draught of Living Death',
      'Salamanderâ€™s blood; lionfish spines; wiggentree bark; dittany leaves',
      'Add 5 lionfish spines to heated cauldron â†’ salamanderâ€™s blood â†’ finelyâ€‘chopped wiggentree bark â†’ dittany leaves â†’ stir clockwise Ã—7. Complete within 15 seconds.',
      '15 seconds'),
    P('Pepperup Potion','Intermediate','âœ… Students','Cures cold; warms; steam from ears',
      'Peppermint oil; warming spices; coldâ€‘fighting herbs; willow bark; honey; steam crystals',
      'Bodyâ€‘temp base; add oils, spices, herbs, willow bark, honey, steam crystals until steaming.',
      '45 minutes','Side effect: steam from ears for ~1 hour','', '', 'Glover Hipworth'),
    P('Calming Draught','Intermediate','âœ… Students','Calms shock, trauma, distress',
      'Peppermint oil; chamomile; valerian root; soothing moss; peace lily petals',
      'Steep chamomile â†’ add peppermint carefully â†’ ground valerian â†’ soothing moss â†’ lily petals â†’ simmer to pale blue.',
      '50 minutes','Dangerous to pets'),
    P('Dreamless Sleep Potion','Intermediate','âš ï¸ Medical Wing','Provides dreamless sleep',
      'Lavender; valerian; dreamâ€‘suppressing mushrooms; peaceful moss; slumber seeds; moonstone dust',
      'Steep lavender â†’ add valerian â†’ mushrooms â†’ moss â†’ seeds â†’ pinch moonstone â†’ simmer to pale purple.',
      '45 minutes','', '', '6â€“8 hours'),
    P('Sleeping Draught','Intermediate','âš ï¸ Medical Wing','Deep sleep',
      'Poppy extract; drowsy mushrooms; sleep herbs; valerian; chamomile; slumber moss',
      'Extract poppy â†’ add mushrooms â†’ steep herbs â†’ add valerian & chamomile â†’ slumber moss â†’ simmer to deep purple.',
      '50 minutes','', '', '6â€“8 hours'),
    P('Skeleâ€‘Gro','Advanced','âš ï¸ Medical Wing','Regrows bones (painful)',
      'Calcium powder; bone dust; regrowth herbs; structural minerals; healing crystals; growth stimulants; unicorn horn shavings',
      'Boneâ€‘growth temp; calcium base â†’ bone dust â†’ regrowth herbs â†’ minerals â†’ crystals â†’ stimulants â†’ unicorn shavings; thick chalkâ€‘white.',
      '3 hours','Severe pain; horrible taste'),
    P('Bloodâ€‘Replenishing Potion','Advanced','âš ï¸ Medical Wing','Restores blood after loss',
      'Iron filings; beetroot juice; crushed ruby; 3 drops freelyâ€‘given unicorn blood; strengthening nettle; copper shavings',
      'Bodyâ€‘temp base â†’ beet juice â†’ iron â†’ crushed ruby â†’ unicorn blood â†’ nettle â†’ copper; deep red, gently pulsing surface.',
      '1 hr 30 min','Administer hourly as needed'),
    P('Bruise Removal Paste','Intermediate','âœ… Students','Removes bruises (topical)',
      'Murtlap essence; healing herbs; powdered moonstone; comfrey root; arnica',
      'Extract murtlap â†’ grind herbs + comfrey â†’ mix with moonstone + arnica to smooth paleâ€‘yellow paste.',
      '45 minutes','Topical'),
    P('Burnâ€‘Healing Paste','Intermediate','âœ… Students','Heals burns (topical)',
      'Aloe extract; ground salamander scales; powdered silver unicorn horn; cooling mint; optional phoenix tears',
      'Blend aloe + scales + silver â†’ mint â†’ optional phoenix tears; pale green, cool to touch.',
      '30 minutes','Topical'),
    P('Essence of Dittany','Intermediate','âœ… Students','Regrows skin over wounds; silver mix for werewolf bites',
      'Fresh dittany; healing enhancement oils; (optional) powdered silver',
      'Press fresh dittany â†’ add oils â†’ mix with silver for lycanthropy wounds â†’ bottle in dark glass.',
      '30 minutes','Topical'),
    P('Mandrake Restorative Draught','Advanced','âš ï¸ Medical Wing','Reverses petrification/cursed transfiguration',
      'Mature mandrakes (â‰¥12 months)',
      'Harvest with earmuffs; stew to extract essence; strain; coordinated with Herbology.',
      'Requires mature plants'),
    P('Dr. Ubblyâ€™s Oblivious Unction','Advanced','âš ï¸ Medical Wing','Heals wounds caused by thoughts (apply to temples/forehead)',
      'Memory moss; thoughtâ€‘healing herbs; mental balm root; consciousness clay; mindâ€‘mending crystals; peace lily essence',
      'Steep moss â†’ add herbs â†’ grind root â†’ mix clay â†’ add crystals â†’ finish with peace lily while thinking peaceful thoughts.',
      '1 hr 15 min'),
    P('Antiâ€‘Paralysis Potion','Advanced','âš ï¸ Medical Wing','Heals paralysis',
      'Mandrake root; powdered lionfish spine; crushed beetles; essence of dittany; phoenix feather ash',
      'Grate mandrake; boil â†’ add lionfish spine â†’ add beetles counterâ€‘clockwise â†’ lower heat; 3 drops dittany â†’ dust phoenix ash until deep purple with silver smoke.',
      '1 hr 15 min')
  ],

  'Antidotes':[
    P('Antidote to Common Poisons','Advanced','âœ… Advanced Students','Reverses common poison effects (golden)',
      'Bezoar; 7 mistletoe berries; freshly ground unicorn horn',
      'Crush bezoar â†’ add berries â†’ grind unicorn horn fresh â†’ combine in silver cauldron; gentle heat; simmer 30 min; strain through unicorn hair mesh.',
      '45 minutes','', '', '', '', 'Magical Draughts and Potions â€” Jigger'),
    P('Antidote to Uncommon Poisons','Master','âš ï¸ Medical Wing','Composite antidote per Golpalottâ€™s Third Law',
      'Varies (composite greater than sum of parts)',
      'Identify components â†’ compute composite ratios â†’ combine individual antidotes â†’ neutralize with bezoar base; may require unicorn blood/phoenix tears.',
      '2â€“4 hours'),
    P('Deflating Draught','Intermediate','âœ… Students','Deflates anything swollen by magical means (antidote to Swelling Solution)',
      'Shrivelling fig; deflating bellows essence; compressed air moss; reducing root; shrinking violet petals',
      'Mash fig â†’ add bellows essence â†’ compressed air moss â†’ reducing root (fine) â†’ violet petals; counterâ€‘stir while visualising deflation to pale blue hiss.',
      '25 minutes','Usage: antidote to Swelling Solution'),
    P('Love Potion Antidote','Advanced','âš ï¸ Medical Wing','Counteracts love potions; crystalâ€‘clear â€œfresh airâ€ scent',
      'Clearâ€‘sight herbs; antiâ€‘obsession root; realityâ€‘restoring moss; trueâ€‘feeling flowers; independence essence; clarity crystals',
      'Steep clearâ€‘sight â†’ antiâ€‘obsession â†’ moss â†’ flowers â†’ essence â†’ crystals; administer at first signs.',
      '1 hour')
  ],

  'Utility & Academic':[ 
    P('Cure for Boils (Boil Cure)','Elementary','âœ… Year 1','Cures boils; pink smoke when successful',
      'Dried nettles; crushed snake fangs; stewed horned slugs; porcupine quills',
      'Heat to exactly 250Â°F â†’ add 6 crushed fangs (10s heat) â†’ add 4 horned slugs â†’ **remove from fire** â†’ add porcupine quills â†’ stir Ã—5 clockwise â†’ wandâ€‘wave.',
      '33â€“45 minutes','Never add quills while still heating'),
    P('Herbicide Potion','Elementary','âœ… Year 1','Damages/kills plants (coursework/greenhouse control)',
      'Flobberworm mucus; horklump juice; ground lionfish spines; withering root',
      'Equal mucus + horklump â†’ add ground spines â†’ withering root â†’ heat to earthy brown.',
      '35 minutes','Magical Draughts and Potions â€” Jigger'),
    P('Cough Potion','Elementary','âœ… Students','Soothes coughs; golden syrup',
      'Honey; thyme essence; eucalyptus; soothing moss; throatâ€‘ease root; lemon balm',
      'Warm honey â†’ thyme â†’ steep eucalyptus â†’ add moss â†’ grate throatâ€‘ease â†’ lemon balm; reduce to syrup.',
      '40 minutes','1 spoonful as needed'),
    P('Forgetfulness Potion','Elementary','âœ… Year 1','Induces forgetfulness',
      'Lethe water; forgetful moss; memoryâ€‘erasing mushrooms; absentâ€‘minded grass; confusion seeds',
      'Lethe base â†’ counterâ€‘stir moss â†’ mushrooms â†’ grass â†’ seeds; simmer to cloudy gray.',
      '40 minutes','Keep notes while brewing'),
    P('Hairâ€‘Raising Potion','Elementary','âœ… Year 2','Makes hair stand on end; occasional sparks',
      'Rat tails; static essence; shock grass; standing moss',
      'Add tails â†’ static essence â†’ shock grass (rapid stir) â†’ standing moss; brew until occasional sparks.',
      '30 minutes'),
    P('Hiccoughing Solution','Elementary','âœ… Students','Causes hiccups (15â€“30 min)',
      'Jumping beans; hiccup herbs; spasm seeds; tickling grass; surprise essence',
      'Beans â†’ rapidâ€‘stir herbs â†’ spasm seeds â†’ tickling grass â†’ surprise essence; potion makes small â€œhicâ€ sounds.',
      '20 minutes'),
    P('Developing Solution','Elementary','âœ… Students','Develops moving magical photographs',
      'Silver nitrate; motion essence; captured movement crystals; temporal fluid; enchanted water',
      'Dissolve silver nitrate in enchanted water â†’ motion essence drops â†’ movement crystals â†’ temporal fluid â†’ gentle mix.',
      '20 minutes'),
    P('Wideye Potion','Intermediate','âœ… Students','Prevents sleep; awakens from drugging/concussion',
      'Alertness berries; wakeâ€‘up root; stimulating crystals; consciousness herbs; antiâ€‘drowsy moss; clarity essence',
      'Crush berries â†’ grind root â†’ add crystals â†’ herbs â†’ moss â†’ clarity essence; vigorous stir to bright yellow.',
      '40 minutes','Duration 8â€“12 hours'),
    P('Witâ€‘Sharpening Potion','Advanced','âœ… Advanced Students','Enhances mental clarity; antidote to Confusing Concoction',
      'Brainâ€‘boosting herbs; intelligence crystals; sharpâ€‘mind root; clarity moss; focus berries; wisdom bark',
      'Steep herbs â†’ crystals â†’ grate sharpâ€‘mind root â†’ clarity moss â†’ focus berries â†’ wisdom bark; concentrate while stirring.',
      '55 minutes'),
    P('Invigoration Draught','Intermediate','âœ… Students','Boosts energy (4â€“6 hours)',
      'Ginseng root; energy crystals; vigorous vine; stimulating spices; powdered caffeine beans; lightningâ€‘caught water',
      'Grind ginseng â†’ lightningâ€‘water base â†’ energy crystals â†’ vigorous vine â†’ spices â†’ caffeine beans; stir until sparkles.',
      '35 minutes','Duration 4â€“6 hours'),
    P('Beautification Potion','Intermediate','âœ… Students','Temporarily enhances appearance',
      'Rose petals; unicorn hair; powdered pearls; butterfly wings; morning dew; narcissus root',
      'Collect dew at sunrise â†’ gentle heat â†’ rose petals one by one â†’ unicorn hair â†’ powdered pearls â†’ crushed butterfly wings â†’ grated narcissus root counterâ€‘stir to pearlâ€‘pink shimmer.',
      '1 hr 45 min','Duration 6â€“8 hours'),
    P('Baruffio\'s Brain Elixir','Intermediate','ðŸš« Banned during examinations','Claims to increase mental agility and concentration',
      'Ground ginkgo; powdered runespoor eggs; essence of hellebore; grated ginger; newt eyes',
      'Grind ginkgo â†’ warm water â†’ runespoor eggs (3 pinches) â†’ 5 drops hellebore â†’ grate ginger â†’ add newt eyes; simmer 20 minutes to bright yellow; peppermint/ginger scent.',
      '30 minutes','Effectiveness variable; placebo suspected'),
    P('Alihotsy Draught','Intermediate','âœ… Advanced Students','Causes hysterical laughter',
      'Alihotsy leaves; giggling water; powdered fairy wings',
      'Crush leaves to purple juice â†’ add to 2 cups giggling water â†’ gentle heat with clockwise stir â†’ when tiny pops appear, add powdered fairy wings â†’ continue until bright pink and giggling.',
      '25 minutes'),
    P('Confidence Potion','Intermediate','âœ… Students','Temporarily boosts confidence (4â€“6 hrs)',
      'Lion\'s mane mushroom; powdered rooster feathers; golden syrup; courage flower petals; crushed garnets',
      'Prepare lion\'s mane â†’ warm water base â†’ rooster feathers â†’ golden syrup â†’ petals one by one â†’ crushed garnets; stir boldly clockwise to amber glow.',
      '50 minutes','Duration 4â€“6 hours'),
    P('Fleshâ€‘Eating Slug Repellent','Elementary','âœ… Students','Repels fleshâ€‘eating slugs (spray)',
      'Salt crystals; bitter herbs; repelling essence; slugâ€‘bane root; protective spices; garlic extract',
      'Dissolve salt â†’ add bitter herbs â†’ repelling essence â†’ ground slugâ€‘bane â†’ spices â†’ garlic; strong repulsive smell.',
      '25 minutes'),
    P('Laughâ€‘Inducing Potion','Intermediate','âœ… Students','Causes uncontrollable laughter (1â€“2 hrs)',
      'Giggling grass; tickling mushrooms; joy berries; humor herbs; laughingâ€‘gas essence; comedy crystals',
      'Giggling grass â†’ chopped mushrooms â†’ joy berries â†’ herbs while thinking funny thoughts â†’ gas essence â†’ crystals; bubbles with laughter.',
      '30 minutes','Duration 1â€“2 hours')
  ],

  'Transformation & Disguise':[
    P('Polyjuice Potion','Master','ðŸš« Forbidden','Transforms drinker into another person',
      'Lacewing flies (stewed 21 days); fluxweed (picked full moon); boomslang skin; horn of bicorn; targetâ€™s hair/body part',
      'Timed sequence per Restricted Section; add target sample before dosing; extreme caution.',
      '~1 month','Appearance varies by target','10 minâ€“12 hrs','', 'Moste Potente Potions'),
    P('Invisibility Potion','Advanced','ðŸš« Banned (Stealth)','Renders drinker invisible',
      'Leaping toadstool cap; knotgrass sprig; troll bogey',
      'Cap â†’ knotgrass â†’ troll bogey; brew exactly 60 seconds.',
      '60 seconds'),
    P('Ageing Potion','Intermediate','ðŸš« Banned','Temporarily ages the drinker (dosageâ€‘based)',
      'Newt spleens; powdered moonstone; unicorn tail hair; dried billywig stings',
      'Medium heat; mash 3 spleens; stir Ã—7 clockwise; pinch moonstone per year; 1 unicorn hair; simmer 30 min; add stings (1/decade); counterâ€‘stir to pale gold.',
      '45 minutes'),
    P('Shrinking Solution','Intermediate','âœ… Thirdâ€‘Year','Shrinks living creatures; toad test subject â†’ tadpole',
      'Daisy roots; caterpillars; shrivelfigs (skinned); leech juice',
      'Add daisy roots (prepared) â†’ caterpillars at critical temps â†’ skinned shrivelfigs with precise timing â†’ leech juice; maintain exact temperature.',
      '2 hours','Failure may poison subject')
  ],

  'Enhancement & Combat (Restricted)':[
    P('Fire Protection Potion','Advanced','âœ… Advanced Students','Protects from burns (2â€“3 hrs)',
      'Salamander blood; asbestos powder; fireâ€‘resistant scales; phoenix ash; cooling crystals; flameâ€‘proof moss',
      'Medium heat; salamander base â†’ asbestos â†’ ground scales â†’ phoenix ash â†’ cooling crystals â†’ moss.',
      '1 hr 30 min','Duration 2â€“3 hours'),
    P('Edurus Potion','Advanced','ðŸš« Combat','Rockâ€‘like skin (20s)',
      'Ashwinder eggs; mongrel fur',
      'Crack eggs â†’ add fur â†’ stir clockwise; brew exactly 30 seconds.',
      '30 seconds','Duration ~20 seconds'),
    P('Maxima Potion','Advanced','ðŸš« Combat','Increases spell damage (30s)',
      'Leech juice; spider fang',
      'Leech juice â†’ spider fang; brew 30 seconds.',
      '30 seconds','Duration ~30 seconds'),
    P('Focus Potion','Advanced','ðŸš« Combat','Reduces spell cooldown times (brief)',
      'Dugbog tongue; lacewing flies',
      'Add tongue â†’ add flies; brew 60 seconds.',
      '60 seconds'),
    P('Thunderbrew Potion','Advanced','ðŸš« Combat','Storm aura stuns/damages nearby enemies',
      'Leech juice; shrivelfig; stench of the dead (Inferius)',
      'Leech juice â†’ shrivelfig â†’ stench; clockwise stir; brew exactly 90 seconds.',
      '90 seconds'),
    P('Strengthening Solution','Intermediate','ðŸš« Enhancement','Temporarily increases physical strength',
      'Salamander blood; powdered griffin claw; strengthâ€‘enhancing herbs',
      'Blood base â†’ griffin claw â†’ strength herbs; staged brew over several days until inner glow.',
      'Several days'),
    P('Felix Felicis (Liquid Luck)','Master','ðŸš« Banned in exams/competitions','Grants extraordinary luck',
      'Ashwinder egg; horseradish; squill bulb juice; murtlap tentacle; tincture of thyme; occamy eggshell; powdered common rue',
      'Precise lunar timing; ingredients added in exact order; stir at dawn daily for 183 days at constant temperature; drops leap like goldfish when finished.',
      'Six months','Side effects: giddiness, overconfidence','', 'Zygmunt Budge (16th c.)')
  ],

  'Forbidden & Controlled':[
    P('Amortentia','Advanced','ðŸš« Banned (Love)','Strongest love potion; obsession, not true love',
      'Pearl dust; ashwinder eggs; rose thorns (dawn); peppermint; moonstone; essence of belladonna',
      'Pearl dust base in silver cauldron at 150Â°F â†’ eggs (figureâ€‘8 stir) â†’ thorns â†’ peppermint â†’ moonstone â†’ 3 drops belladonna â†’ mature 7 days; daily stir.',
      '7 days','Motherâ€‘ofâ€‘pearl sheen; spiraling steam'),
    P('Babbling Beverage','Advanced','ðŸš« Mindâ€‘altering','Uncontrollable nonsensical speech',
      'Tongueâ€‘twisting treacle; confused newt eyes; babbling brook water; powdered foolâ€™s parsley',
      'Heat brook water until it whispers â†’ treacle (figureâ€‘8) â†’ eyes one by one â†’ parsley â†’ erratic 5â€‘min stir; potion mutters.',
      '35 minutes'),
    P('Befuddlement Draught','Advanced','ðŸš« Mindâ€‘altering','Confusion and reckless behavior',
      'Scurvy grass; lovage; sneezewort; confusion moss',
      'Chop scurvy grass â†’ alternate pinches of lovage & sneezewort â†’ randomâ€‘stir moss â†’ heat until unpredictable swirl.',
      '40 minutes'),
    P('Dizziness Draught','Intermediate','ðŸš« Dangerous','Dizziness/lightheadedness (visual swirl)',
      'Spinning seeds; vertigo vine; whirling moss; confusion grass; dizzy daisy petals',
      'Rapid stir with seeds â†’ add vine â†’ circular moss â†’ figureâ€‘8 grass â†’ daisy petals; erratic stir until swirl.',
      '30 minutes'),
    P('Elixir to Induce Euphoria','Advanced','âœ… Sixthâ€‘Year','Irrational happiness; sunshine yellow',
      'Peppermint; shrivelfig; porcupine quills; castor beans; wormwood',
      'Colorâ€‘shift sequence per syllabus; peppermint counters sideâ€‘effects.',
      '2 hours','Side effects: singing; noseâ€‘tweaking'),
    P('Draught of Peace','Advanced','âœ… Fifthâ€‘Year (Supervised)','Relieves anxiety; turquoise with silvery vapor',
      'Powdered moonstone; syrup of hellebore; porcupine quills; powdered unicorn horn',
      'Precise colorâ€‘transition sequence ending turquoise with silver vapor; exact droplet counts; overdose can be fatal.',
      '3â€“4 hours','Overdose risk: irreversible sleep/death'),
    P('Black Fire Potion','Advanced','ðŸš« Special Authorization','Allows passage through black fire',
      'Salamander scales; phoenix feather; fire seed pods; dragon blood; asbestos powder; flameâ€‘resistant moss',
      'Extreme magical fire â†’ scales â†’ feather â†’ seed pods â†’ pour dragon blood while clockwise stir â†’ asbestos â†’ moss; glows redâ€‘orange.',
      '2 hours'),
    P('Veritaserum','Master','ðŸš« Ministryâ€‘controlled','Forces truthfulness; clear, tasteless',
      'Truth moss (7â€‘day steep); honesty herbs (7 days); compulsion crystals (day 14); lunar essence (full moon); revealing root (day 21)',
      'Sequential, lunarâ€‘timed brewing; mature to complete clarity; max dose 3 drops; Occlumency can resist.',
      '28 days','Limit: 3 drops; resistible via Occlumency'),
    P('Elixir of Life','Master','ðŸš« Not available','Grants immortality (requires Philosopherâ€™s Stone)',
      'â€”','â€”','â€”','Legendary, unavailable'),
    P('Confusing Concoction (Confusing Draught)','Advanced','ðŸš« Mindâ€‘altering','Causes confusion in drinker; must properly thicken',
      'Scurvy grass; lovage; sneezewort; muddling moss',
      'Chop scurvy grass with silver knife â†’ lovage clockwise â†’ sneezewort in increments â†’ muddling moss counterâ€‘stir â†’ brew until thick/viscous gray or it fails.',
      'Extended','Common failure: doesnâ€™t thicken'),
    P('Swelling Solution','Intermediate','ðŸš« Dangerous if splashed','Causes dramatic enlargement on contact',
      'Salamander blood; puffing powder; expansion essence',
      'Blood base â†’ puffing powder â†’ expansion essence â†’ heat to vigorous bubbling.',
      '40 minutes'),
    P('Draught of Living Death','Master','ðŸš« Faculty & Adults only','Places drinker in deathâ€‘like sleep',
      'Powdered root of asphodel; infusion of wormwood; valerian roots; sopophorous bean; hellebore essence',
      'Asphodel into wormwood â†’ chopped (not crushed) valerian â†’ slice sopophorous bean with flat silver dagger for more juice â†’ counterâ€‘stir to pale pink â†’ add 13 drops hellebore â†’ should turn clear when perfect.',
      '3 hours')
  ],

  'Playerâ€‘Created Potions':[]
};

// OC container (empty by default)
const OC = Object.fromEntries(TYPES.map(t=>[t,[]]));

/***********************
 * APP
 ***********************/
const $ = s=>document.querySelector(s);
const sideTabs = document.querySelector('.tabs');
const listEl = $('#list');
const subjectTitle = $('#subjectTitle');
const sideEl = document.querySelector('.side');

function updateSticky(){
  const fits = window.innerWidth >= 981 && (sideEl.scrollHeight + 24) <= window.innerHeight;
  sideEl.classList.toggle('is-sticky', fits);
}

const state = { q:'', dif:'', year:'', subject: TYPES[0], oc:false };

function buildTabs(){
  sideTabs.innerHTML='';
  TYPES.forEach(s=>{
    const b=document.createElement('button');
    b.textContent=s;
    b.setAttribute('aria-current', String(state.subject===s));
    b.addEventListener('click', ()=>{ state.subject=s; render(); });
    sideTabs.appendChild(b);
  });
}

function dataFor(type){
  const canon = CANON[type]||[];
  const oc = state.oc ? (OC[type]||[]) : [];
  return [...canon.map(x=>({...x, oc:false})), ...oc.map(x=>({...x, oc:true}))];
}

function allowedByYear(dif){
  if(!state.year) return true;
  const lvl = dif||'';
  switch(state.year){
    case 'y12': return ['Elementary'].includes(lvl);
    case 'y35': return ['Elementary','Intermediate'].includes(lvl);
    case 'y67': return ['Elementary','Intermediate','Advanced'].includes(lvl);
    case 'post': return true;
    default: return true;
  }
}

function matches(pt){
  if(state.dif && pt.difficulty!==state.dif) return false;
  if(!allowedByYear(pt.difficulty)) return false;
  if(state.q){
    const blob=((pt.name||'')+' '+(pt.effect||'')+' '+(pt.ingredients||'')+' '+(pt.notes||'')+' '+(pt.restriction||'')+' '+(pt.appearance||'')+' '+(pt.inventor||'')+' '+(pt.source||'')).toLowerCase();
    if(!blob.includes(state.q)) return false;
  }
  return true;
}

function makeRow(pt){
  const it=document.createElement('details'); it.className='item';
  const sum=document.createElement('summary');

  const nameWrap=document.createElement('div'); nameWrap.className='namewrap';
  const name=document.createElement('div'); name.className='name'; name.textContent=pt.name;
  const preview=document.createElement('div'); preview.className='effect-preview'; preview.textContent=pt.effect||'â€”';
  nameWrap.append(name, preview);

  const meta=document.createElement('div'); meta.className='meta';
  const pill1=document.createElement('span'); pill1.className='pill'; pill1.textContent=pt.difficulty||'â€”';
  meta.appendChild(pill1);
  const pill2=document.createElement('span'); pill2.className='pill'; pill2.textContent=pt.restriction||'â€”';
  meta.appendChild(pill2);
  if(pt.oc){ const oc=document.createElement('span'); oc.className='pill'; oc.textContent='OC'; meta.appendChild(oc); }

  sum.append(nameWrap, meta);

  const body=document.createElement('div'); body.className='body';
  const specs=document.createElement('div'); specs.className='spec grid-2';
  specs.innerHTML =
    `<dl>
      <dt>Ingredients</dt><dd>${pt.ingredients||'â€”'}</dd>
      <dt>Brewing Time</dt><dd>${pt.time||'â€”'}</dd>
      <dt>Appearance/Duration</dt><dd>${[pt.appearance, pt.duration].filter(Boolean).join(' â€¢ ')||'â€”'}</dd>
      <dt>Inventor/Source</dt><dd>${[pt.inventor, pt.source].filter(Boolean).join(' â€¢ ')||'â€”'}</dd>
    </dl>
    <dl>
      <dt>Instructions</dt><dd>${pt.instructions||'â€”'}</dd>
      <dt>Notes</dt><dd class="notes">${pt.notes||''}</dd>
    </dl>`;
  body.appendChild(specs);

  it.append(sum, body);
  return it;
}

function render(){
  // tabs current state
  [...sideTabs.children].forEach(btn=> btn.setAttribute('aria-current', String(btn.textContent===state.subject)));
  subjectTitle.textContent = state.subject;

  const items = dataFor(state.subject).filter(matches).sort((a,b)=> a.name.localeCompare(b.name));
  listEl.innerHTML='';
  if(!items.length){
    const d=document.createElement('div'); d.className='empty'; d.textContent='No entries. Add potions to the data or loosen filters.';
    listEl.appendChild(d);
    return;
  }
  items.forEach(pt=> listEl.appendChild(makeRow(pt)));
}

// Controls
$('#q').addEventListener('input', e=>{ state.q=e.target.value.trim().toLowerCase(); render(); });
$('#dif').addEventListener('change', e=>{ state.dif=e.target.value; render(); });
$('#year').addEventListener('change', e=>{ state.year=e.target.value; render(); });
$('#modeCanon').addEventListener('click', ()=>{ state.oc=false; $('#modeCanon').setAttribute('aria-pressed','true'); $('#modeAll').setAttribute('aria-pressed','false'); render(); });
$('#modeAll').addEventListener('click', ()=>{ state.oc=true; $('#modeAll').setAttribute('aria-pressed','true'); $('#modeCanon').setAttribute('aria-pressed','false'); render(); });

// Boot
buildTabs();
updateSticky();
window.addEventListener('resize', updateSticky);
render();
</script>
</body>
</html>
